---
title: "P8105 Homework 2"
author: "Siyue Gao"
date: '`r format(Sys.time(), "%Y-%m-%d")`'
output: github_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(collapse = TRUE, message = FALSE, warning = FALSE)
```

```{r}
library(tidyverse)
library(readxl)
```

# Problem 1


## Reading and Cleaning

First, read and clean the raw dataset. Only retain line, station, name, station latitude / longitude, routes served, entry, vending, entrance type, and ADA compliance.

```{r}
transit_data = read_csv("data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>% 
  janitor::clean_names() %>% 
  select(line:vending, ada) %>% 
  mutate(
    route8 = as.character(route8),
    route9 = as.character(route9),
    route10 = as.character(route10),
    route11 = as.character(route11),
    entry = ifelse(entry == "YES", TRUE, FALSE)
    )
```

To this point, after reading in the raw dataset, I used `select` function to make the `transit_data` retain only 20 variables, including `line`, `station_name`, `station_latitude`, `station_longitude`, route served (`route1` to `route11`), `entry`, `entrance_type`, `exit_only`, `vending`, and `ada`. The resulting dataset contains `r nrow(transit_data)` rows and `r ncol(transit_data)` columns. `route1` to `route7` are recognized as character by R, however, `route8` to `route11` are recognized as numeric. As a result, I used the `mutate` function to convert it into character variable. The `entry` of `yes` / `no` is converted into a logical variable.

The data are not "tidy": route served should be a single variable. In this case, we may need to convert `route1` to `route11` from a wide to a long format.


## Some Questions

Now I would answer some questions using these data as required in the Homework instructions.

1.  How many distinct stations are there?

```{r}
transit_data %>% 
  select(line, station_name) %>% 
  distinct() %>% 
  nrow()
```

There are 465 distinct stations.

2.    How many stations are ADA compliant?

```{r}
transit_data %>% 
  filter(ada == TRUE) %>% 
  select(line, station_name) %>% 
  distinct() %>% 
  nrow()
```

There are 84 stations that are ADA compliant.

3.    What proportion of station entrances / exits without vending allow entrance?

For this question, I first subset the dataset limited to `vending` == `NO`. Then, I count the `entry` variable and get the proportion.

```{r}
transit_data %>% 
  filter(vending == "NO") %>% 
  count(entry) %>%
  mutate(prop = n/sum(n))
```

37.7% of station entrances / exits without vending allows entrance.


## Reformatting

First, convert `route` to long format by `pivot_longer()`.

```{r}
transit_tidy_data = pivot_longer(
    transit_data,
    route1:route11,
    names_to = "route_num",
    names_prefix = "route",
    values_to = "route")
```

Then, we can answer some questions based on the tidy dataset.

*   How many distinct stations serve the A train?

```{r}
transit_tidy_data %>% 
  filter(route == "A") %>% 
  select(line, station_name) %>% 
  distinct() %>% 
  nrow()
```

There are 60 distinct stations serving the A train.

*   Of the stations that serve the A train, how many are ADA compliant?

```{r}
transit_tidy_data %>% 
  filter(route == "A") %>% 
  filter(ada == TRUE) %>% 
  select(line, station_name) %>% 
  distinct() %>% 
  nrow()
```

Of the stations that serve the A train, there are 17 stations that are ADA compliant.


# Problem 2


## Reading and Cleaning

Read and clean the **Mr. Trash Wheel** sheet. The following code chunk specifies the "Mr. Trash Wheel" sheet to be imported, and omits non-data entries and rows that do not contain dumpster-specific data (the total summary rows). The number of sports balls are rounded to the nearest integer by `mutate()` and are converted to an integer variable afterward by `as.interger()`.

```{r}
mr_trash = 
  read_excel("./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
             sheet = "Mr. Trash Wheel") %>% 
  janitor::clean_names() %>% 
  select(-c("x15":"x17")) %>% 
  mutate(dumpster = as.numeric(dumpster)) %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(sports_balls = as.integer(round(sports_balls, digits = 0)))
```

Conduct a similar process to the **Professor Trash Wheel**.

```{r}
pro_trash = 
  read_excel("./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
             sheet = "Professor Trash Wheel") %>% 
  janitor::clean_names() %>%
  filter(!is.na(dumpster)) %>% 
  mutate(sports_balls = as.integer(round(sports_balls, digits = 0)))
```

