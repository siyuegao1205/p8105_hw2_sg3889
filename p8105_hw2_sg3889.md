P8105 Homework 2
================
Siyue Gao
2022-10-03

``` r
library(tidyverse)
library(readxl)
```

# Problem 1

## Reading and Cleaning

First, read and clean the raw dataset. Only retain line, station, name,
station latitude / longitude, routes served, entry, vending, entrance
type, and ADA compliance.

``` r
transit_data = read_csv("data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>% 
  janitor::clean_names() %>% 
  select(line:vending, ada) %>% 
  mutate(
    route8 = as.character(route8),
    route9 = as.character(route9),
    route10 = as.character(route10),
    route11 = as.character(route11),
    entry = ifelse(entry == "YES", TRUE, FALSE)
    )
```

To this point, after reading in the raw dataset, I used `select`
function to make the `transit_data` retain only 20 variables, including
`line`, `station_name`, `station_latitude`, `station_longitude`, route
served (`route1` to `route11`), `entry`, `entrance_type`, `exit_only`,
`vending`, and `ada`. The resulting dataset contains 1868 rows and 20
columns. `route1` to `route7` are recognized as character by R, however,
`route8` to `route11` are recognized as numeric. As a result, I used the
`mutate` function to convert it into character variable. The `entry` of
`yes` / `no` is converted into a logical variable.

The data are not “tidy”: route served should be a single variable. In
this case, we may need to convert `route1` to `route11` from a wide to a
long format.

## Some Questions

Now I would answer some questions using these data as required in the
Homework instructions.

1.  How many distinct stations are there?

``` r
transit_data %>% 
  select(line, station_name) %>% 
  distinct() %>% 
  nrow()
## [1] 465
```

There are 465 distinct stations.

2.  How many stations are ADA compliant?

``` r
transit_data %>% 
  filter(ada == TRUE) %>% 
  select(line, station_name) %>% 
  distinct() %>% 
  nrow()
## [1] 84
```

There are 84 stations that are ADA compliant.

3.  What proportion of station entrances / exits without vending allow
    entrance?

For this question, I first subset the dataset limited to `vending` ==
`NO`. Then, I count the `entry` variable and get the proportion.

``` r
transit_data %>% 
  filter(vending == "NO") %>% 
  count(entry) %>%
  mutate(prop = n/sum(n))
## # A tibble: 2 × 3
##   entry     n  prop
##   <lgl> <int> <dbl>
## 1 FALSE   114 0.623
## 2 TRUE     69 0.377
```

37.7% of station entrances / exits without vending allows entrance.

## Reformatting

First, convert `route` to long format by `pivot_longer()`.

``` r
transit_tidy_data = pivot_longer(
    transit_data,
    route1:route11,
    names_to = "route_num",
    names_prefix = "route",
    values_to = "route")
```

Then, we can answer some questions based on the tidy dataset.

-   How many distinct stations serve the A train?

``` r
transit_tidy_data %>% 
  filter(route == "A") %>% 
  select(line, station_name) %>% 
  distinct() %>% 
  nrow()
## [1] 60
```

There are 60 distinct stations serving the A train.

-   Of the stations that serve the A train, how many are ADA compliant?

``` r
transit_tidy_data %>% 
  filter(route == "A") %>% 
  filter(ada == TRUE) %>% 
  select(line, station_name) %>% 
  distinct() %>% 
  nrow()
## [1] 17
```

Of the stations that serve the A train, there are 17 stations that are
ADA compliant.

# Problem 2

## Reading and Cleaning

Read and clean the **Mr. Trash Wheel** sheet. The following code chunk
specifies the “Mr. Trash Wheel” sheet to be imported, and omits non-data
entries and rows that do not contain dumpster-specific data (the total
summary rows). The number of sports balls are rounded to the nearest
integer by `mutate()` and are converted to an integer variable afterward
by `as.interger()`.

``` r
mr_trash = 
  read_excel("data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
             sheet = "Mr. Trash Wheel") %>% 
  janitor::clean_names() %>% 
  select(-c("x15":"x17")) %>% 
  mutate(dumpster = as.numeric(dumpster)) %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(sports_balls = as.integer(round(sports_balls, digits = 0)))
```

Conduct a similar process to the **Professor Trash Wheel**.

``` r
pro_trash = 
  read_excel("data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
             sheet = "Professor Trash Wheel") %>% 
  janitor::clean_names() %>%
  filter(!is.na(dumpster)) %>% 
  mutate(sports_balls = as.integer(round(sports_balls, digits = 0)))
```

## Combining

Use `bind_rows()` to combine the two trash wheel datasets together. Add
a new variable called `trash_wheel` to keep track of which Trash Wheel
is which.

``` r
mr_trash = mr_trash %>% 
  mutate(trash_wheel = "Mr. Trash Wheel")

pro_trash = pro_trash %>% 
  mutate(trash_wheel = "Professor Trash Wheel")

trash = 
  bind_rows(mr_trash, pro_trash) %>%
  select(trash_wheel, everything())
```

### Data Description

The resulting dataset contains observations on 524 trash wheels
collected by two different projects, including 453 by Mr. Trash Wheel
and 71 by Professor Trash Wheel. The data include 15 variables, and are
primarily describing the collected trash information at specific
dumpsters at different times – weight in tons, volume in cubic yards,
amount of different types of trash, such as plastic bottles,
polystyrene, cigarette butts, etc.

The total weight of trash collected by **Professor Trash Wheel** was
135.5 tons. The total number of sports balls collected by **Mr. Trash
Wheel** in 2020 was 856.

# Problem 3

## Reading and Cleaning

After reading in the pols-months.csv dataset, we would like to tidy it
by separating `mon` into `year`, `month` and `day` (replace month number
with month name using `month.name[]` and discard the `day` variable),
creating a `president` variable taking values `gop` and `dem` by
`pivot_longer`.

``` r
pols_months = read_csv("data/fivethirtyeight_datasets/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("year", "month", "day"), sep = "-") %>% 
  arrange(year, month) %>% 
  mutate(
    month = month.name[as.numeric(month)]
    ) %>% 
  pivot_longer(
    cols = starts_with("prez"),
    names_to = "president", 
    names_prefix = "prez_",
    values_to = "party"
  ) %>%
  select(-day) %>% 
  select(year, month, president, party, everything())
  
```

The following code chunk aims to tidy the snp.csv by a similar process.
Note that the `year` and `month` variables are kept in the same format
and same ascending sequence as in the `pols_months` dataset.

``` r
snp = read_csv("data/fivethirtyeight_datasets/snp.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    date = format(as.Date(date, format = "%m/%d/%y"), "%Y-%m"),
    ) %>% 
  separate(date, into = c("year","month"), sep = "-") %>% 
  mutate(
    year = as.numeric(year),
    year = ifelse(year > 2015, year - 100, year)
    ) %>% 
  arrange(year, month) %>% 
  mutate(
    year = as.character(year),
    month = month.name[as.numeric(month)]
    )
```

The following code chunk aims to tidy the unemployment.csv to be merged
with `pols_months` and `snp`. A `pivot_longer()` process will be
necessary. Note that the `year` and `month` should be in the same format
as those in the previous datasets.

``` r
unemployment = read_csv("data/fivethirtyeight_datasets/unemployment.csv") %>%
  janitor::clean_names() %>% 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "unemployment"
  ) %>%
  mutate(
    year = as.character(year),
    month = str_to_title(month),
    month = month.name[match(month, month.abb)]
  )
```
